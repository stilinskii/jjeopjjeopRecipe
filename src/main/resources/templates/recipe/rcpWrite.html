<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="fragments/head('레시피')">
    <meta charset="UTF-8" />
    <title>레시피 작성 폼</title>
</head>
<body>
<nav th:replace="fragments/nav :: front-nav('recipe')"></nav>
<main class="custom container">
<p class="fw-bold fs-2 text-start">새 레시피 등록하기</p>
    <form action="/recipe/write" method="post" enctype="multipart/form-data">
    <div class="row" style="margin-bottom:15px;">
        <div class="col-4 d-grid gap-2 d-md-block img_up">
            <label for="rcp_file" style="cursor:pointer;">
            <img src="/media/images/rcp_mainimg.png" width="100%" height="230px" alt="main image"/>
            </label>
            <input type="file" id="rcp_file" name="upload" style="display: none;">
            <button type="button" class="btn btn-dark" style="width: 100%;">
            <label for="rcp_file" style="width: 100%; height:100%; cursor:pointer;">대표 이미지 첨부</label>
            </button>
        </div>
        <div class="col-8">
            <p><input type="text" class="form-control" name="rcp_name" width="90%" placeholder="레시피 이름"></p>
            <select class="form-select" name="time" id="rcp_time">
                <option value="">소요시간</option>
                <option value="10분 이내">10분 이내</option>
                <option value="20분 이내">20분 이내</option>
                <option value="30분 이내">30분 이내</option>
                <option value="1시간 이내">1시간 이내</option>
                <option value="2시간 이내">2시간 이내</option>
                <option value="2시간 이상">2시간 이상</option>
            </select>
            <select class="form-select" name="difficulty" id="difficulty">
                <option value="">난이도</option>
                <option value="쉬움">쉬움</option>
                <option value="보통">보통</option>
                <option value="어려움">어려움</option>
            </select>
            <select class="form-select" name="amount" id="amount">
                <option value="">양</option>
                <option value="1인분">1인분</option>
                <option value="2인분">2인분</option>
                <option value="3인분">3인분</option>
                <option value="4인분">4인분</option>
                <option value="5인분 이상">5인분 이상</option>
            </select>
            <textarea class="form-control" name="summary" placeholder="레시피를 간단히 소개해 주세요."></textarea>
        </div>
    </div>
        <p>*레시피에 어울리는 분류를 선택해 주세요.</p>
        <div class="cate_box">
            <input type="hidden" name="cateArr" id="cateArr" value="">
            <p>
                <span>종류별</span>
                <span th:each="cate1 : ${cateList}" th:if="${cate1.cate_cate} == 1">
                    &nbsp&nbsp
                    <a href="#" th:value="${cate1.cate_seq}">
                        <span th:text="${cate1.cate_name}" style="color: #fff;">종류별</span>
                    </a>
                </span>
            </p>
            <p>
                <span>재료별</span>
                <span th:each="cate2 : ${cateList}" th:if="${cate2.cate_cate} == 2">
                    &nbsp&nbsp
                    <a href="#" th:value="${cate2.cate_seq}">
                        <span th:text="${cate2.cate_name}" style="color: #fff;">재료별</span>
                    </a>
                </span>
            </p>
            <p>
                <span>상황별</span>
                <span th:each="cate3 : ${cateList}" th:if="${cate3.cate_cate} == 3">
                    &nbsp&nbsp
                    <a href="#" th:value="${cate3.cate_seq}">
                        <span th:text="${cate3.cate_name}" style="color: #fff;">상황별</span>
                    </a>
                </span>
            </p>
        </div>
        <hr/>
        <p class="fw-bold fs-2 text-start">재료</p>
        <textarea name="rcp_parts_dtls" placeholder="양파 반 쪽, 굴소스 한 숟갈, 베이컨 100g..."></textarea>
        <hr/>
        <p class="fw-bold fs-2 text-start">요리 순서</p>
        <div class="manual_container">
        <div class="rcp_manual">
            <p class="fw-bold fs-4 text-start manual_step">1</p>
            <textarea name="manual_txt"></textarea>
            <p class="d-flex justify-content-between">
            <input type="file" id="upload_manual" name="upload_manual" >
              <button type="button" class="btn btn-dark">
                <label for="upload_manual">이미지 첨부</label>
              </button>
            <a class="btn btn-danger removeManual">순서 삭제</a>
            </p>
        </div>
        </div>
        <button type="button" id="addManual" class="btn btn-secondary" style="width: 100%; margin-bottom: 15px;">요리 순서 추가</button>
        <hr/>
        <p class="fw-bold fs-2 text-start">해쉬태그</p>
        <p>*레시피에 어울리는 해쉬태그를 입력해 주세요.</p>
        <textarea name="hash_tag" placeholder="귀찮을 때, 자취요리, 야채듬뿍..."></textarea>
        <hr/>
    <p class="d-flex justify-content-between">
        <a th:href="@{/recipe/list}" class="btn btn-danger">
            &nbsp&nbsp취소&nbsp&nbsp
        </a>
        <button type="submit" class="btn btn-primary">&nbsp&nbsp작성&nbsp&nbsp</button>
    </p>
</form>
</main>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<script>
    var manualNo = 1;
    var inputContainer = document.querySelector(".manual_container");
    var inputNode = document.querySelector(".rcp_manual");
    var n1 = inputNode.cloneNode(true);

    $('#addManual').on("click", function(e){
        e.preventDefault();
        manualNo++;
        n1.querySelector(".manual_step").innerHTML = manualNo;
        inputContainer.appendChild(n1.cloneNode(true));
    });

    $(document).on('click', '.removeManual', function(){
        if(manualNo > 1){
            manualNo--;
            console.log(manualNo);
            console.log($(this).parent().parent().children(":first").html());
            $(this).parent().parent().remove();

            $('.rcp_manual').each(function(index, item){
                console.log(item.firstChild);
            });
        }
    });

    var imgUp = document.querySelector(".img_up");
    var imgSrc = imgUp.querySelector("img");
    var fileInput = imgUp.querySelector(`input[type="file"]`);
    fileInput.addEventListener('input', () => {
        const reader = new FileReader();
		reader.addEventListener('load', () => {
		    imgSrc.setAttribute('src', reader.result);
		});
		reader.readAsDataURL(fileInput.files[0]);
    });

    var cateArr = [];

    $(".cate_box a").on("click", function(e){
        e.preventDefault();
        if(cateArr.indexOf($(this).attr("value")) == -1){
            cateArr.push($(this).attr("value"));
            $(this).attr("style", "color: black; font-weight: bold;");
        }else{
            cateArr.splice(cateArr.indexOf($(this).attr("value")), 1);
            $(this).attr("style", "color: #FFF;");
        }
        console.log($(this).attr("value"));
        $('#cateArr').attr('value', cateArr);
    });

</script>
</body>
</html>